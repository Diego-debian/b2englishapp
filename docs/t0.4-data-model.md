# T0.4 Data Model Specification (Beta)

Este documento define las tablas conceptuales `content_lessons` y `content_blocks`. Es un modelo de datos lógico, **NO** un script de migración SQL.

## 1. Principios de Diseño

1.  **Additive-Only**: Las nuevas tablas no tocan ni modifican las existentes (users, attempts, etc.).
2.  **Read-Only Beta**: El contenido se considera "estático" desde la perspectiva de la App. No hay ABM (Alta/Baja/Modificación) desde el frontend.
3.  **Loose Coupling**: La relación con el sistema funcional es débil (solo via URLs en CTAs).

---

## 2. Table: `content_lessons`

Contiene la metadata de alto nivel de cada lección.

### Campos

| Campo | Tipo Lógico | Restricciones | Descripción |
| :--- | :--- | :--- | :--- |
| `id` | PK (tipo no especificado en esta fase) | Unique | Identificador interno. |
| `slug` | String | Unique, Not Null | Identificador público URL-friendly; estrategia de rutas se define en fase frontend. |
| `title` | String | Not Null | Título visible para el usuario. |
| `description` | String | Nullable | Subtítulo o resumen corto. |
| `order` | Integer | Not Null | Orden relativo de la lección en la lista. |
| `status` | Enum (String) | 'draft', 'published', 'archived' | Control de visibilidad. |

### Reglas
- `slug` debe ser alfanumérico con guiones (kebab-case).
- `status` default: 'draft'.

---

## 3. Table: `content_blocks`

Contiene el contenido atómico de cada lección.

### Campos

| Campo | Tipo Lógico | Restricciones | Descripción |
| :--- | :--- | :--- | :--- |
| `id` | PK (tipo no especificado en esta fase) | Unique | Identificador interno. |
| `lesson_id` | FK | Not Null | Referencia a `content_lessons.id`. Cascade Delete conceptual. |
| `type` | Enum (String) | 'text', 'youtube', 'cta' | Tipo de bloque. Define la estructura de `data`. |
| `order` | Integer | Not Null | Posición del bloque dentro de la lección. |
| `data` | JSON / JSONB | Not Null | Payload específico según `type`. |

### Reglas
- Un bloque **SIEMPRE** pertenece a una lección.
- `order` define la secuencia de renderizado.

---

## 4. Estructura del Campo `data` (JSON)

Validación a nivel de aplicación (Pydantic), no necesaria restricción DB.

### A. Type: `text`
```json
{
  "content": "Texto con **formato**..."
}
```

### B. Type: `youtube`
```json
{
  "video_id": "string (11 chars)",
  "caption": "string (opcional)",
  "start": "int (opcional)",
  "end": "int (opcional)"
}
```

### C. Type: `cta`
```json
{
  "label": "string (Texto del botón)",
  "target_type": "internal | external",
  "target": "string (URL relativa o absoluta)",
  "style": "primary | secondary"
}
```

---

## 5. Índices y Constraints (Intención)

1.  **Unique Slug**: Garantizar que no existan dos lecciones con el mismo `slug`.
2.  **Ordneamiento**:
    - Intención de unicidad compuesta: `Unique(lesson_id, order)` para evitar colisiones de posición.
    - Estrategia de orden: `order ASC`; en caso de empate, usar `id ASC` para determinismo.
3.  **FK Integrity**: `content_blocks` huérfanos no permitidos.

---

## 6. Integración con Sistema Actual

### Lo que este modelo NO hace:
- **No almacena Progreso**: Saber si User X leyó Lesson Y **NO** es responsabilidad de estas tablas.
- **No almacena XP**: No hay campos de reward.
- **No almacena Comentarios**: Fuera de scope.

### Punto de Integración:
- El único puente es el campo `data.target` en bloques `cta`, que contiene strings apuntando a rutas como `/app/focus/...`.
- El sistema de contenido es **ignarante** de la existencia de usuarios, sesiones o ejercicios.
