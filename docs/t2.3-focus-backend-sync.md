# T2.3 Focus Backend Sync

> Frontend sends Focus session results to `POST /focus/results` on session end.

---

## Files Modified

| File | Change |
|------|--------|
| `frontend/lib/api.ts` | Added `postFocusResults()` |
| `frontend/app/practice/focus/page.tsx` | Added POST call in `handleNext()` |

---

## Where the POST Happens

**File:** `frontend/app/practice/focus/page.tsx`  
**Function:** `handleNext()` (around line 205)

```typescript
// Send results to backend (once per session)
if (!hasReportedRef.current && selectedTense) {
    hasReportedRef.current = true;
    const payload = {
        tense_slug: selectedTense,
        results: session.results.map(r => ({
            question_id: r.id,
            is_correct: r.isCorrect
        }))
    };
    api.postFocusResults(payload).catch(err => {
        console.warn("[Focus] Failed to sync results:", err);
    });
}
```

---

## Payload Example

```json
{
  "tense_slug": "present-simple",
  "results": [
    { "question_id": "ps-mcq-001", "is_correct": true },
    { "question_id": "ps-fill-002", "is_correct": false },
    { "question_id": "ps-order-003", "is_correct": true }
  ]
}
```

---

## Manual Testing

1. Start frontend: `npm run dev`
2. Start backend with Docker
3. Login and go to `/practice/focus`
4. Select any tense → Complete all 5 questions
5. Open DevTools → Network tab
6. Verify: Single `POST /focus/results` with 200 response
7. Backend logs: Check for incoming request

### Verify No Double POST

- After reaching summary, re-render (resize window, etc.)
- Network tab should show only 1 POST (not 2)

### Verify Error Handling

- Disconnect network before session ends
- Summary should still display correctly
- Console shows: `[Focus] Failed to sync results: ...`

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-01-17 | Initial implementation |
