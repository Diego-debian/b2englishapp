# T2.1 Progress Model (Backend)

## Resumen

El modelo `UserProgress` es **persistente** (SQLAlchemy). El endpoint `GET /progress` estaba crasheando por `ImportError` (el schema `UserProgressOut` existía pero no estaba exportado).

## Modelo de Datos: `user_progress`

| Campo    | Tipo       | Descripción                          |
|----------|------------|--------------------------------------|
| id       | int (PK)   | ID del registro                      |
| user_id  | int (FK)   | Usuario propietario                  |
| verb_id  | int (FK)   | Verbo asociado                       |
| srs_date | datetime   | Próxima fecha de revisión (SRS)      |
| mistakes | int        | Total de errores acumulados          |
| streak   | int        | Racha de respuestas correctas        |

## Cambios Realizados (2026-01-17)

### `backend/app/schemas/__init__.py`
- **Fix**: Añadido `UserProgressOut` al import y `__all__` export.

### Archivos que YA existían (sin cambios):
- `backend/app/crud/progress.py`: `list_user_progress(db, user_id)` ya implementado.
- `backend/app/schemas/progress.py`: `UserProgressOut` ya definido.
- `backend/app/main.py`: Endpoint ya usaba `list_user_progress` y response_model correcto.

## Contrato de API

### POST /progress/init
Inicializa registros de progreso para todos los verbos del usuario.

```http
POST /progress/init
Authorization: Bearer <token>
```

**Response (200 OK):**
```json
{"initialized": 69}
```

---

### GET /progress
Retorna lista de todos los registros de progreso del usuario autenticado.

```http
GET /progress
Authorization: Bearer <token>
```

**Response (200 OK):**
```json
[
  {
    "id": 139,
    "user_id": 15,
    "verb_id": 1,
    "srs_date": "2026-01-18T03:17:18.463776",
    "mistakes": 0,
    "streak": 0
  },
  ...
]
```

> ⚠️ **Nota**: El response es una **lista directa**, no un objeto `{ "items": [...] }`.

## Verificación

```powershell
# 1. Health check
curl http://localhost:8001/health
# {"status":"alive"}

# 2. Obtener token
# POST /token con username/password

# 3. Inicializar progreso
curl -X POST http://localhost:8001/progress/init -H "Authorization: Bearer <token>"
# {"initialized": N}

# 4. Listar progreso
curl http://localhost:8001/progress -H "Authorization: Bearer <token>"
# Lista de objetos UserProgressOut
```

## Estado Final
- ✅ `GET /progress` funciona (200 OK, lista de objetos)
- ✅ `POST /progress/init` funciona (200 OK, cuenta inicializados)
- ✅ Modelo persistente en PostgreSQL
