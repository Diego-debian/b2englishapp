# T1.2 Streak Honesty Fix

> Documentación de la corrección para que el indicador de racha sea honesto.

---

## Problema

El frontend mostraba un contador de "Racha Actual" (días consecutivos de práctica) sin indicar que este dato está almacenado **localmente en el navegador** y **NO está sincronizado con el servidor**.

Esto podía causar confusión:
- Usuario piensa que su racha está respaldada.
- Cambia de dispositivo → racha aparece en 0.
- Borra caché → racha perdida.

---

## Análisis de Fuentes de Datos

### Backend: `user_progress.streak`

**Archivo:** `backend/app/models/progress.py:17`

```python
streak = Column(Integer, default=0, nullable=False)
```

**Propósito:** Streak de SRS por verbo (cuántas veces seguidas el usuario acertó un verbo específico). **NO es una racha diaria**.

### Frontend: `practiceStore.streak`

**Archivo:** `frontend/store/practiceStore.ts:58,252`

```typescript
streak: number;
// ...
storage: createJSONStorage(() => localStorage),
partialize: (state) => ({
  streak: state.streak,
  lastActiveDate: state.lastActiveDate,
  // ...
})
```

**Propósito:** Días consecutivos de práctica. Calculado localmente. **Guardado en localStorage**.

---

## Ubicaciones del UI Modificadas

| Vista | Archivo | Línea | Cambio |
|-------|---------|-------|--------|
| Dashboard header | `dashboard/page.tsx` | 78 | Añadido `(este dispositivo)` |
| Dashboard streak card | `dashboard/page.tsx` | 142 | Añadido `(local)` |
| Practice mobile badge | `practice/page.tsx` | 953 | Añadido `title="Racha guardada en este dispositivo"` |
| Practice sidebar | `practice/page.tsx` | 1232 | Añadido `title="Guardado localmente"` |
| Progress page | `progress/page.tsx` | 86-98 | Ya mostraba placeholder "—" con "Disponible pronto" |

---

## Decisión Tomada

**Opción elegida:** Etiquetar como "local" en lugar de ocultar.

**Razón:**
1. La racha tiene valor motivacional real para el usuario.
2. Ocultar completamente sería confuso para usuarios actuales.
3. Agregar "(local)" / "(este dispositivo)" es transparente y honesto.
4. Los tooltips en badges compactos proveen información sin romper el diseño.

---

## Evidencia

### Backend NO tiene racha diaria

```bash
# Búsqueda de "streak" en backend
grep -r "streak" backend/app/

# Resultados relevantes:
# - models/progress.py:17  → streak por verbo (SRS)
# - crud/progress.py       → incrementa streak de verbo al acertar
# - crud/user.py           → average_streak de verbos para stats
```

**Conclusión:** El backend NO tiene un campo de "racha diaria". Solo tiene streak por verbo.

### Frontend almacena en localStorage

```typescript
// frontend/store/practiceStore.ts:247-249
persist(
  // ...
  {
    name: "b2-practice-storage",
    storage: createJSONStorage(() => localStorage),
```

**Conclusión:** La racha diaria vive en localStorage, no está respaldada.

---

## Verificación Manual

1. **Dashboard** (`/dashboard`)
   - Header: "Estado: Activo • Racha: X días (este dispositivo)"
   - Card oscura: "Racha Actual (local)"

2. **Practice** (`/practice`)
   - Mobile badge: Hover → muestra "Racha guardada en este dispositivo"
   - Sidebar: Hover sobre badge → "Guardado localmente"

3. **Progress** (`/progress`)
   - Ya muestra "—" con "Disponible pronto" (no se modificó)

---

## Archivos Tocados

| Archivo | Acción |
|---------|--------|
| `frontend/app/dashboard/page.tsx` | MODIFICADO (2 líneas) |
| `frontend/app/practice/page.tsx` | MODIFICADO (2 líneas) |
| `docs/t1.2-streak-honesty.md` | CREADO |

---

## Changelog

| Versión | Fecha      | Cambios |
|---------|------------|---------|
| 1.0.0   | 2026-01-16 | Implementación inicial |
