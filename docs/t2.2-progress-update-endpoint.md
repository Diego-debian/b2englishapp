# T2.2 Progress Update Endpoint (Backend)

## Resumen

Endpoint mínimo para actualizar el progreso de un usuario en un verbo específico.
**Requiere** que el usuario haya ejecutado `POST /progress/init` previamente.

## Endpoint

### `POST /progress/update`

Actualiza el progreso para un verbo específico.

#### Request

```http
POST /progress/update
Authorization: Bearer <token>
Content-Type: application/json

{
  "verb_id": 1,
  "is_correct": true
}
```

| Campo       | Tipo   | Descripción                         |
|-------------|--------|-------------------------------------|
| verb_id     | int    | ID del verbo practicado (requerido) |
| is_correct  | bool   | Si la respuesta fue correcta        |

#### Response (200 OK)

```json
{
  "id": 139,
  "user_id": 15,
  "verb_id": 1,
  "srs_date": "2026-01-18T04:00:00.000000",
  "mistakes": 0,
  "streak": 1
}
```

#### Errores

| Código | Detalle                                                   |
|--------|-----------------------------------------------------------|
| 401    | Token inválido o ausente                                  |
| 404    | `Progress not initialized; call POST /progress/init first` |

## Lógica de Actualización (existente en CRUD)

```python
if is_correct:
    streak += 1
    srs_date = now + timedelta(days=min(2 ** streak, 32))
    xp_gain = 10 * (1 + min(streak, 5))
else:
    mistakes += 1
    streak = 0
    srs_date = now + timedelta(days=1)
    xp_gain = 2
```

> ⚠️ Esta lógica SRS ya existía en `crud/progress.py`. No se inventó nueva.

## Archivos Modificados

| Archivo | Cambio |
|---------|--------|
| `backend/app/schemas/progress.py` | Añadido `ProgressUpdateIn` (verb_id, is_correct) |
| `backend/app/schemas/__init__.py` | Export de `ProgressUpdateIn` |
| `backend/app/main.py` | Endpoint actualizado con nuevo schema y 404 handling |

## Verificación con curl

```powershell
# 1. Obtener token
$body = @{ username = "testuser"; password = "pass123" }
$token = (Invoke-RestMethod -Uri "http://localhost:8001/token" -Method POST -ContentType "application/x-www-form-urlencoded" -Body $body).access_token

# 2. Inicializar progreso (requerido)
Invoke-RestMethod -Uri "http://localhost:8001/progress/init" -Method POST -Headers @{ Authorization = "Bearer $token" }

# 3. Actualizar progreso (respuesta correcta)
$payload = '{"verb_id": 1, "is_correct": true}'
Invoke-RestMethod -Uri "http://localhost:8001/progress/update" -Method POST -ContentType "application/json" -Headers @{ Authorization = "Bearer $token" } -Body $payload

# 4. Verificar cambios
Invoke-RestMethod -Uri "http://localhost:8001/progress" -Method GET -Headers @{ Authorization = "Bearer $token" } | Where-Object { $_.verb_id -eq 1 }
```

## Estado Final

- ✅ `POST /progress/update` funciona con payload simplificado
- ✅ Retorna 404 si progreso no inicializado
- ✅ Lógica SRS existente preservada
- ✅ No rompe `/progress` ni `/progress/init`
