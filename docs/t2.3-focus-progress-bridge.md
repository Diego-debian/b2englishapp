# T2.3 Focus Progress Bridge — ABORTED

## Status: ❌ ABORTED (No Mapping Exists)

---

## Problema

Se solicitó conectar `POST /focus/results` con `UserProgress` para actualizar `streak`/`mistakes` por cada `verb_id` afectado.

**Requisito clave:** Mapear `question_id` → `verb_id`

---

## Auditoría Realizada

### 1. Focus Questions (Frontend)

**Archivo:** `frontend/lib/focusQuestions.ts`

```typescript
export interface FocusQuestion {
    id: string;           // "ps_001", "pc_001", etc.
    tenseSlug: string;    // "present-simple", "past-continuous"
    type: "mcq" | "fill_blank" | "order_words";
    prompt: string;
    choices?: string[];
    tokens?: string[];
    answer: string;
    explanation: string;
    // ❌ NO verb_id
}
```

Las preguntas Focus son **ejercicios de gramática de tiempos verbales**, no ejercicios de conjugación de verbos específicos.

Ejemplo:
```typescript
{
    id: "ps_001",
    tenseSlug: "present-simple",
    prompt: "She ______ to work every day.",
    choices: ["go", "goes", "going", "gone"],
    answer: "goes"
}
```

### 2. ActivityQuestion Model (Backend)

**Archivo:** `backend/app/models/activity.py`

```python
class ActivityQuestion(BaseModel):
    __tablename__ = "activity_questions"

    activity_id = Column(Integer, ForeignKey("activities.id"))
    kind = Column(String)
    prompt = Column(Text)
    options = Column(JSON)
    correct_answer = Column(Text)
    explanation = Column(Text)
    xp_reward = Column(Integer)
    sort_order = Column(Integer)
    # ❌ NO verb_id
```

### 3. UserProgress Model (Backend)

**Archivo:** `backend/app/models/progress.py`

```python
class UserProgress(BaseModel):
    __tablename__ = "user_progress"

    user_id = Column(Integer, ForeignKey("users.id"))
    verb_id = Column(Integer, ForeignKey("verbs.id"))  # ✅ Requiere verb_id
    srs_date = Column(DateTime)
    mistakes = Column(Integer)
    streak = Column(Integer)
```

### 4. FocusResultsIn Schema

**Archivo:** `backend/app/schemas/activity.py`

```python
class FocusResultItem(BaseModel):
    question_id: str  # String ID like "ps_001" - NOT in DB
    is_correct: bool
```

---

## Conclusión: NO HAY MAPPING

| Origen | Tipo | Campo verb_id |
|--------|------|---------------|
| Focus Questions (frontend) | Static TypeScript | ❌ No existe |
| ActivityQuestion (backend) | SQLAlchemy Model | ❌ No existe |
| FocusResultItem (schema) | Pydantic | ❌ Solo question_id (str) |

**La arquitectura actual de Focus NO asocia preguntas con verbos.**

Focus es un sistema de práctica de **gramática general de tiempos** que opera completamente separado del sistema SRS de verbos específicos.

---

## Regla del Task

> "Si NO determinable: documentar y ABORTAR implementación (no inventar)."

**Resultado:** Se documenta y se ABORTA la implementación sin inventar mapping.

---

## Opciones Futuras (NO implementar ahora)

1. **Modificar Focus**: Añadir `verb_id` a cada `FocusQuestion` en el frontend (cambio arquitectónico mayor)
2. **Nuevo sistema**: Crear tabla `focus_results` separada de `UserProgress`
3. **Heurísticas**: Parsear el prompt para detectar verbos (no determinístico, propenso a errores)

---

## Archivos Auditados

- `backend/app/main.py` (record_focus_results)
- `backend/app/models/activity.py` (ActivityQuestion)
- `backend/app/models/progress.py` (UserProgress)
- `backend/app/schemas/activity.py` (FocusResultItem)
- `frontend/lib/focusQuestions.ts` (FocusQuestion interface)
- `docs/t2.3-focus-backend-sync.md` (existing documentation)

---

## Estado Final

- ✅ Auditoría completada
- ❌ Implementación ABORTADA
- ✅ Documentación creada
- ✅ No se inventó mapping
- ✅ No se modificó código existente
