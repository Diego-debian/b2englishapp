# T0.2 Workflow & Freeze Rules

> Reglas de colaboraci√≥n Diego ‚Üî Agente para B2English.

---

## Purpose / Alcance

### Cubre
- Proceso de desarrollo (qui√©n hace qu√©)
- Reglas de c√≥digo (qu√© est√° prohibido)
- Pol√≠tica de evidencia
- Checklist de cierre de tareas
- Gesti√≥n de riesgo

### NO cubre
- Arquitectura t√©cnica (ver `t0.1-contract-api.md`)
- Modelo de datos (ver `data_model.md`)
- QA de contenido pedag√≥gico

---

## Roles y Responsabilidades

| Acci√≥n | Diego | Agente |
|--------|:-----:|:------:|
| Crear branch | ‚úÖ | ‚ùå |
| Git commit | ‚úÖ | ‚ùå |
| Git merge/push | ‚úÖ | ‚ùå |
| Escribir c√≥digo | ‚ùå | ‚úÖ |
| Crear/editar docs en `/docs` | ‚ùå | ‚úÖ |
| Ejecutar verificaciones | ‚ùå | ‚úÖ |
| Aprobar cambios | ‚úÖ | ‚ùå |
| Decidir scope/prioridad | ‚úÖ | ‚ùå |

---

## Reglas Absolutas

### Prohibido para el Agente

1. **NO hacer Git** ‚Äî branch/commit/push lo hace Diego
2. **NO refactor masivo** ‚Äî cambios localizados √∫nicamente
3. **NO recrear p√°ginas/componentes desde cero** ‚Äî modificar existentes
4. **NO inventar endpoints/campos/contratos** ‚Äî solo evidencia del c√≥digo
5. **NO crear tablas/migraciones** sin aprobaci√≥n expl√≠cita
6. **NO cambiar comportamiento de `/focus/results`** (frozen)
7. **NO tocar XP/gamificaci√≥n** sin aprobaci√≥n

### Obligatorio antes de cerrar tarea

- [ ] Listar archivos tocados
- [ ] Ejecutar verificaciones (build/lint/health)
- [ ] Documentar pasos de prueba manual
- [ ] Actualizar docs si cambia contrato/comportamiento

---

## Minimal Safe Change

**Definici√≥n:** Cambio que:
- Afecta ‚â§3 archivos
- No modifica contratos de API (request/response)
- No requiere migraciones
- Pasa build + lint
- Es revertible en un commit

**Ejemplos v√°lidos:**
- A√±adir export a `__init__.py`
- Corregir typo en mensaje de error
- A√±adir campo opcional con default

**Ejemplos NO v√°lidos:**
- Cambiar firma de endpoint
- Refactorizar componente React completo
- A√±adir nueva tabla

---

## Evidence Policy

### Fuentes permitidas
1. C√≥digo en repositorio (`backend/`, `frontend/`)
2. OpenAPI (`/openapi.json`, `/docs`)
3. Schemas Pydantic (`backend/app/schemas/`)
4. Tipos TypeScript (`frontend/lib/types.ts`)
5. Documentaci√≥n existente (`/docs`)

### Unknowns
Si algo no se puede determinar con evidencia:

> **Frase obligatoria:** "No determinable con evidencia del c√≥digo actual."

**NO inventar.** Si no hay evidencia ‚Üí documentar y preguntar.

---

## Task Close Checklist

Antes de reportar tarea completada:

```markdown
## Checklist de Cierre

- [ ] 1. **Archivos tocados** ‚Äî lista completa
- [ ] 2. **Comandos ejecutados** ‚Äî build, lint, curl, etc.
- [ ] 3. **Verificaciones pasadas** ‚Äî health, build OK
- [ ] 4. **Prueba manual** ‚Äî pasos exactos documentados
- [ ] 5. **Docs actualizadas** ‚Äî si cambi√≥ contrato/comportamiento
- [ ] 6. **No breaking changes** ‚Äî o documentados en "IMPORTANT"
- [ ] 7. **C√≥digo limpio** ‚Äî sin console.log/debug en prod
- [ ] 8. **Revertible** ‚Äî cambio puede deshacerse f√°cil
```

---

## Gesti√≥n de Riesgo

### Criterios RIESGO ALTO

| Indicador | Acci√≥n |
|-----------|--------|
| Toca >5 archivos | ‚ö†Ô∏è Dividir en sub-tareas |
| Modifica contrato API | ‚ö†Ô∏è Requiere aprobaci√≥n Diego |
| Requiere migraci√≥n DB | üõë Bloquear hasta aprobar |
| Afecta autenticaci√≥n/JWT | üõë Bloquear hasta aprobar |
| Cambia l√≥gica XP/streak | üõë Bloquear hasta aprobar |

### Alternativa: M√≠nima Versi√≥n Segura

Cuando el riesgo es alto:
1. Implementar versi√≥n m√≠nima sin cambios estructurales
2. Documentar limitaciones
3. Proponer mejora como tarea separada

**Ejemplo:**
- Pedido: "Conectar Focus con Progress"
- Riesgo: No existe mapping verb_id
- M√≠nima versi√≥n segura: Documentar ABORT + raz√≥n (T2.3)

### Cu√°ndo Bloquear Merge

- Falla build o lint
- No hay prueba manual documentada
- Cambia comportamiento sin doc
- Riesgo alto sin aprobaci√≥n

---

## Plantillas Copiables

### 1. Prompt Estructura para Agente

```markdown
Tarea: [ID] [Nombre] ([BACKEND|FRONTEND|DOCS])

PROHIBIDO:
- [lista de restricciones espec√≠ficas]

Objetivo:
[descripci√≥n clara]

Pasos obligatorios:
1) [paso con evidencia requerida]
2) [paso con evidencia requerida]
...

Antes de cerrar:
- Listar archivos tocados
- Ejecutar verificaci√≥n ([comando])
- Pasos de prueba manual
```

### 2. Reporte Final del Agente

```markdown
## [ID] Completado ‚úÖ

### Archivos Tocados
| Archivo | Cambio |
|---------|--------|
| `path/file.py` | Descripci√≥n breve |

### Comandos Ejecutados
- `docker-compose up -d`
- `curl http://localhost:8001/health`
- `npm run build`

### Verificaci√≥n
- ‚úÖ Health: OK
- ‚úÖ Build: OK
- ‚úÖ [endpoint]: [resultado]

### Prueba Manual
1. Paso 1
2. Paso 2
3. Verificar: [qu√© esperar]

### Docs Actualizadas
- `docs/[file].md`

### No se toc√≥
- [lista de cosas expl√≠citamente no modificadas]
```

### 3. Checklist QA Manual

```markdown
## QA Manual ‚Äî [Feature]

### Pre-requisitos
- [ ] Backend running (`docker-compose up -d`)
- [ ] Frontend running (`npm run dev`)
- [ ] Usuario de test creado

### Flujo Principal
- [ ] Paso 1: [acci√≥n] ‚Üí [esperar]
- [ ] Paso 2: [acci√≥n] ‚Üí [esperar]
- [ ] Paso 3: [acci√≥n] ‚Üí [esperar]

### Edge Cases
- [ ] Sin token: debe retornar 401
- [ ] Datos inv√°lidos: debe retornar 422
- [ ] Recurso no existe: debe retornar 404

### Verificaci√≥n Final
- [ ] No errores en consola browser
- [ ] No errores en logs backend
- [ ] Comportamiento consistente
```

---

## Archivos Tocados

- `docs/t0.2-workflow-freeze-rules.md` (this file)

---

*Creado: 2026-01-17*
