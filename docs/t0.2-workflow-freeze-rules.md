# T0.2 Workflow + Freeze Rules

Este documento es **NORMATIVO**. Define cómo se trabaja en el proyecto B2English para garantizar estabilidad y prevenir errores humanos o de agentes.

## 1. Roles y Responsabilidades

- **Diego (Owner)**:
    - Único con permisos de escritura en rama `main` y Git push.
    - Responsable final de aprobar cambios y realizar merges.
    - Ejecuta comandos críticos de infraestructura.

- **Agente (Executor Restringido)**:
    - Implementa tareas específicas bajo demanda.
    - **NO** decide refactors arquitectónicos.
    - **NO** inventa reglas ni modifica código fuera del alcance.
    - Debe solicitar confirmación antes de cambios clasificados como RISK.

- **ChatGPT (Arquitecto / PM)**:
    - Define la estrategia y desglose de tareas.
    - Mantiene el contexto global del proyecto.
    - Autoriza el paso entre fases del ciclo de trabajo.

---

## 2. Ciclo de Trabajo Obligatorio (Per Task)

**Regla de Oro**: Una tarea = un branch = un merge. **Prohibido combinar tareas.**

1.  **Definición**: El PM define el objetivo, alcance y entregables exactos.
2.  **Paquete Técnico**: El Agente analiza y propone un plan (ficheros a tocar, lógica a implementar).
3.  **Rama**: Diego crea/checkout a una rama bajo la convención `phase{N}/t{X.Y}-slug` (ej: `phase0/t0.1-contract-api`).
    - *Nota: Eliminar referencias a `feat/...`*
4.  **Ejecución**: El Agente aplica cambios incrementalmente.
5.  **Verificación**:
    - Tests automatizados (si aplican y existen).
    - Verificación manual documentada por el Agente.
6.  **Merge Request**: El Agente notifica "Listo para revisión". Diego revisa.
7.  **Cierre**: Merge a `main` y borrado de rama.

---

## 3. Freeze Rules (Inmutables)

Los siguientes elementos son **SOLO LECTURA** o requieren un proceso de RFC (Request for Comments) para ser modificados.

### 3.1. Contrato API
- Definido en: `docs/t0.1-contract-api.md`.
- **Regla**: El Frontend NO puede llamar endpoints que no estén en este contrato. El Backend NO puede alterar la firma de estos endpoints sin actualizar primero el contrato y obtener aprobación.

### 3.2. Focus Mode
- **Estado**: Core Feature Estable.
- **Regla**: La lógica de `Focus` (selección de tiempos, ejecución rápida, sin XP compleja) es sagrada. No se debe intentar "unificar" con el modo Run normal si eso implica complejidad innecesaria.

### 3.3. XP Semantics
- **Regla**: El XP se otorga **por respuesta correcta** en modo normal. En Focus mode, **XP = 0** (según contrato actual en `docs/t0.1-contract-api.md`).
- **Prohibido**: Cambiar la lógica de XP sin un ticket específico de "Gamification Overhaul".

### 3.4. Estructura de Carpetas
- Frontend: `frontend/app`, `frontend/lib`, `frontend/components`.
- Backend: `backend/app/main.py`, `backend/app/schemas`, `backend/app/models`.
- **Prohibido**: Mover archivos o crear nuevas carpetas raíz sin autorización explícita ("No mover carpetas").

### 3.5. Zustand Stores
- Los stores actuales (`useStore`, etc.) manejan el estado global crítico.
- **Regla**: No dividir ni refactorizar los stores existentes a menos que sea el objetivo único de la tarea.

### 3.6. Naming Conventions
- Backend: `snake_case` para Python (funciones, vars), `PascalCase` para clases (Pydantic models).
- Frontend: `camelCase` para TS/JS, `PascalCase` para Componentes React.
- **Regla**: Respetar convención existente. No "arreglar" estilos "feos" si funcionan.

---

## 4. Clasificación de Cambios

Antes de aplicar cualquier cambio, el Agente debe clasificarlo:

| Tipo | Definición | Requerimiento | Ejemplo |
| :--- | :--- | :--- | :--- |
| **DOCS** | Solo documentación (`.md`, comentarios). No afecta ejecución. | **Auto-aprobado** (notify al final). | Crear `t0.1-contract.md`. |
| **SAFE** | Cambios menores, aislados, reversibles, sin efectos secundarios en DB/Auth. | **Aviso previo** en plan. | Añadir un botón estético, corregir typo en UI. |
| **RISK** | Cambios en lógica de negocio, schemas DB, Auth, API Contracts. | **Aprobación explícita** obligatoria antes de escribir código. | Migrar DB, cambiar auth token flow, refactor api.ts. |
| **FORBIDDEN** | Acciones fuera de alcance o peligrosas. | **ABORTAR**. | Borrar DB prod, commitear a main directo, refactorizar proyecto entero. |

---

## 5. Anti-Desastre Protocol

### 5.1. Desviación del Agente
Si el Agente empieza a tocar archivos no listados en el plan original o sugiere "mejoras" no pedidas:
1.  **STOP**: El usuario debe detener la generación.
2.  **RESET**: Recordar al agente las `Freeze Rules`.
3.  **SAFE REVERT**: Deshacer cambios no autorizados con `git restore .` (o revertir ficheros específicos).
    - *Nota*: `git reset --hard` es **PELIGROSO** y solo debe ser ejecutado por Diego.

### 5.2. Cuándo Abortar
- Si el Agente dice "No encuentro el archivo X, voy a crearlo" (y X debería existir).
- Si el Agente propone `npm audit fix --force` o actualizaciones masivas de dependencias.
- Si el Agente intenta reescribir scripts de verificación existentes para que pasen los tests (hacer trampas).

### 5.3. Evidencia para Merge
Antes de cualquier merge a `main`, se exige:
- **Lint pass** (outputs de ESLint/Pylint si existen).
- **Build pass** (outputs de build scripts si existen).
- "It works on my machine": Screenshot o log de consola del Agente demostrando que la feature funciona.
